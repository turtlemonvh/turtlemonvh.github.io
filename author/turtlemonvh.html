<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Systems Doing - turtlemonvh</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Systems Doing  <strong>Looking for beauty in the complex and the simple.</strong></a></h1>
                <nav><ul>
                    <li><a href="/pages/home.html">Home</a></li>
                    <li><a href="/pages/projects.html">Projects</a></li>
                    <li><a href="/category/articles.html">Articles</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/quick-and-dirty-kubernetes.html">Quick and dirty kubernetes</a></h1>
<footer class="post-info">
        <abbr class="published" title="2017-10-27T18:47:00-04:00">
                Published: Fri 27 October 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/turtlemonvh.html">turtlemonvh</a>
        </address>
<p>In <a href="/category/articles.html">Articles</a>.</p>
<p>tags: <a href="/tag/kubernetes.html">kubernetes</a> <a href="/tag/docker.html">docker</a> <a href="/tag/sftp.html">sftp</a> </p>
</footer><!-- /.post-info --><h1>The Problem</h1>
<p>As part of our analytics solution at Ionic, my team was working on a system to push files to customer owned endpoints.  We wanted to do a quick validation that pushed to a server outside our network was working.</p>
<p>We already had a test environment running locally with <a href="https://github.com/atmoz/sftp">an sftp docker image</a>, and since I didn't already have a public server sitting around to setup an sftp on, I decided this was a great opportunity to play around with Google Cloud's Container service and kubernetes to spin up a quick helper service.</p>
<p>I started here: <a href="https://cloud.google.com/sdk/docs/quickstart-linux">https://cloud.google.com/sdk/docs/quickstart-linux</a>.  I installed all this into a Centos 7 vagrant box that my team uses for most of our development.</p>
<div class="highlight"><pre><span></span><span class="err">#</span><span class="x"> Download, extract, install, init</span>
<span class="x">wget https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-sdk-177.0.0-linux-x86_64.tar.gz</span>
<span class="x">tar xzvf google-cloud-sdk-177.0.0-linux-x86_64.tar.gz</span>
<span class="x">./google-cloud-sdk/install.sh</span>

<span class="err">#</span><span class="x"> Move it to a better place than `/tmp` since I&#39;m going to be sticking this on my path</span>
<span class="x">sudo mv google-cloud-sdk /opt/</span>
<span class="x">export PATH=</span><span class="p">$</span><span class="nv">PATH</span><span class="x">:/opt/google-cloud-sdk/bin</span>

<span class="err">#</span><span class="x"> Init</span>
<span class="x">gcloud init</span>

<span class="err">#</span><span class="x"> Get credentials for the cluster</span>
<span class="err">#</span><span class="x"> This is pretty cool - it gives you a url to visit in your browser, redirects you to an Oauth authorization page, and finally gives you a token to paste back into your console.</span>
<span class="err">#</span><span class="x"> I replaced by project id with XXXX.</span>
<span class="x">gcloud container clusters get-credentials sftp --zone us-central1-a --project ionictest-XXXX</span>
</pre></div>


<h1>The first hiccup: install path</h1>
<p>This was all working pretty well, but then I ran into issues when I ran <code>gcloud components install kubectl</code>.  There were permission issues because <code>gcloud</code> tries to write a scratch directory at the same level as its installation directory (i.e. in <code>/opt</code> instead of in <code>/opt/google-cloud-sdk</code>.)  This was a strange choice, since it meant that I had to nest the installation another level deeper.</p>
<div class="highlight"><pre><span></span><span class="err">#</span><span class="x"> Nesting nesting</span>
<span class="x">sudo mkdir -p /opt/google</span>
<span class="x">sudo chown -R vagrant:vagrant /opt/google</span>
<span class="x">sudo mv /opt/google-cloud-sdk /opt/google</span>

<span class="err">#</span><span class="x"> Fix path</span>
<span class="err">#</span><span class="x"> Really this was more manual since I removed the old bin path and also updated ~/.bashrc</span>
<span class="x">export PATH=</span><span class="p">$</span><span class="nv">PATH</span><span class="x">:/opt/google/google-cloud-sdk/bin</span>

<span class="err">#</span><span class="x"> Now installation works</span>
<span class="x">gcloud components install kubectl</span>
</pre></div>


<p>At this point the path was bjorked.  When I tried to run <code>kubectl run</code> I got this mysterious error</p>
<div class="highlight"><pre><span></span><span class="n">error</span><span class="o">:</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">discover</span> <span class="n">supported</span> <span class="n">resources</span><span class="o">:</span> <span class="n">Get</span> <span class="n">https</span><span class="o">://</span><span class="n">XX</span><span class="o">.</span><span class="na">XX</span><span class="o">.</span><span class="na">XX</span><span class="o">.</span><span class="na">XX</span><span class="sr">/api: error executing access token command &quot;/opt/google-cloud-sdk/bin/gcloud config config-helper --format=json&quot;: err=fork/exec /opt/google-cloud-sdk/bin/g</span><span class="n">cloud</span><span class="o">:</span> <span class="n">no</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span> <span class="n">output</span><span class="o">=</span>
</pre></div>


<p>Notice the path is pointing to the old installation location.  I reset my PATH, logged out of the vm and logged back in, and re-ran <code>gcloud components install kubectl</code>, none of which worked.  Then I re-ran the <code>gcloud container clusters get-credentials</code>, which worked.  So I guess the path to the binary is stored somewhere in the credentials config?  I'm not sure.  This article is called "quick and dirty" for a reason.</p>
<p>Now to launch containers.</p>
<div class="highlight"><pre><span></span>kubectl run sftp --image=atmoz/sftp --port 22
kubectl expose deployment sftp --type=LoadBalancer --port 22 --target-port 22
</pre></div>


<p>Alright - we're running!</p>
<h1>The second hiccup: container arguments</h1>
<p>Well, almost.  When I checked the Google Container Engine dashboard I saw the the containers has the status <code>CrashLoopBackoff</code>, which didn't sound good.  I dug into the kubectl cli a bit more and found some useful commands.</p>
<div class="highlight"><pre><span></span># List items
kubectl get pods
kubectl get services
kubectl get deployments

# Clear out items (very helpful when testing)
kubectl delete pod sftp-2557270963-pc8q8
kubectl delete service sftp
kubectl delete deployment sftp
</pre></div>


<p>I leave it to the kubernetes docs to define what the things are in depth, but in brief the pods are containers and services and deployments are higher level management concepts to work with containers.  For the point of this article the most important take aways are this</p>
<ul>
<li>If you delete a pod, it will come back.</li>
<li>If you want to stop something from running and start over, delete the service and the deployment. The pods will go away with those.</li>
</ul>
<p>So - now we have pods deployed, but crashing.  The missing link here was the difference between kubernetes commands and docker entrypoints.</p>
<div class="highlight"><pre><span></span># What our docker compose looks like for running locally
# Use the default entrypoint, override the command
version: &#39;2&#39;
services:
  sftp:
    image: atmoz/sftp
    command: username:password:::export

# What we had to do in kubectl
# Use the default command, send an argument
kubectl run sftp --image=atmoz/sftp --port=22 -- &quot;ionic:pass:::export&quot;
</pre></div>


<h1>Final steps and success</h1>
<p>Once that was updated, I just had to expose the services again (<code>kubectl expose deployment sftp --type=LoadBalancer --port 22 --target-port 22</code>).  I also had to wait for the service to come up.  You can check this via <code>kubectl get services</code> and waiting until the <code>EXTERNAL-IP</code> field changes from "pending" to a real ip.  Once that was ready, and I could sftp in!</p>
<div class="highlight"><pre><span></span>[vagrant@localhost ~]$ sftp username@XX.XX.XX.XX
username@XX.XX.XX.XX&#39;s password:
Connected to XX.XX.XX.XX.
sftp&gt; ls export/
export/testfile.json
</pre></div>


<p>I hope that was helpful.  I have been using docker daily for a few years now, but this is my first time playing with kubernetes.  If I did something stupid, let me know!  You can find me on twitter (<code>@turtlemonvh</code>).</p><p>There are <a href="/quick-and-dirty-kubernetes.html#disqus_thread">comments</a>.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/basic-vs-enhanced-health-checks-on-aws-elb.html" rel="bookmark"
                           title="Permalink to Basic vs Enhanced Health Checks on AWS ELB">Basic vs Enhanced Health Checks on AWS ELB</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-06-29T09:00:00-04:00">
                Published: Thu 29 June 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/turtlemonvh.html">turtlemonvh</a>
        </address>
<p>In <a href="/category/articles.html">Articles</a>.</p>
<p>tags: <a href="/tag/alexa.html">alexa</a> <a href="/tag/elasticbeanstalk.html">elasticbeanstalk</a> <a href="/tag/aws.html">aws</a> <a href="/tag/biblescholar.html">biblescholar</a> </p>
</footer><!-- /.post-info -->                <h1>The Problem</h1>
<p>Yesterday I started getting a lot of emails from Amazon saying that there were issues with the ELB application that runs my Alexa App.</p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Something fishy with <a href="https://twitter.com/hashtag/ELB?src=hash">#ELB</a> on <a href="https://twitter.com/awscloud">@awscloud</a> over the last 24 hours... (no changes to application and load is stable and low) <a href="https://t.co/1wo2GupypW">pic.twitter.com ...</a></p></blockquote>
                <a class="readmore" href="/basic-vs-enhanced-health-checks-on-aws-elb.html">read more</a>
<p>There are <a href="/basic-vs-enhanced-health-checks-on-aws-elb.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/validating-biblescholar-scraping.html" rel="bookmark"
                           title="Permalink to Validating BibleScholar Scraping">Validating BibleScholar Scraping</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-01-02T14:00:00-05:00">
                Published: Mon 02 January 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/turtlemonvh.html">turtlemonvh</a>
        </address>
<p>In <a href="/category/articles.html">Articles</a>.</p>
<p>tags: <a href="/tag/python.html">python</a> <a href="/tag/scraping.html">scraping</a> <a href="/tag/biblescholar.html">biblescholar</a> </p>
</footer><!-- /.post-info -->                <p>As with any data scraping tool, verifying correctness in BibleScholar's verse scraping utilities was pretty important.  After my first run through verses, here is what I was seeing between versions.  Note that this is before I added the ESV translation, which as you'll see below is the version ...</p>
                <a class="readmore" href="/validating-biblescholar-scraping.html">read more</a>
<p>There are <a href="/validating-biblescholar-scraping.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/setting-up-ssl-for-an-elasticbeanstalk-application.html" rel="bookmark"
                           title="Permalink to Setting up SSL for an ElasticBeanstalk Application">Setting up SSL for an ElasticBeanstalk Application</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-01-01T18:00:00-05:00">
                Published: Sun 01 January 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/turtlemonvh.html">turtlemonvh</a>
        </address>
<p>In <a href="/category/articles.html">Articles</a>.</p>
<p>tags: <a href="/tag/alexa.html">alexa</a> <a href="/tag/elasticbeanstalk.html">elasticbeanstalk</a> <a href="/tag/aws.html">aws</a> <a href="/tag/biblescholar.html">biblescholar</a> <a href="/tag/ssl.html">ssl</a> </p>
</footer><!-- /.post-info -->                <p>In <a href="/introducing-the-biblescholar-alexa-application.html">my last article</a> I discussed how I created an Alexa application using AWS ElasticBeanstalk.  I left off stuck in the last step of getting the site set up with a SSL certificate from a trusted <a href="https://en.wikipedia.org/wiki/Certificate_authority">CA</a>.</p>
<p>In general AWS makes the process of setting up SSL for a site ...</p>
                <a class="readmore" href="/setting-up-ssl-for-an-elasticbeanstalk-application.html">read more</a>
<p>There are <a href="/setting-up-ssl-for-an-elasticbeanstalk-application.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/introducing-the-biblescholar-alexa-application.html" rel="bookmark"
                           title="Permalink to Introducing the BibleScholar Alexa application">Introducing the BibleScholar Alexa application</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-12-31T10:00:00-05:00">
                Published: Sat 31 December 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/turtlemonvh.html">turtlemonvh</a>
        </address>
<p>In <a href="/category/articles.html">Articles</a>.</p>
<p>tags: <a href="/tag/alexa.html">alexa</a> <a href="/tag/elasticbeanstalk.html">elasticbeanstalk</a> <a href="/tag/aws.html">aws</a> <a href="/tag/biblescholar.html">biblescholar</a> </p>
</footer><!-- /.post-info -->                <p>When I went to the <a href="https://reinvent.awsevents.com/">AWS Re:Invent conference</a> this November, every attendee got an <a href="https://www.amazon.com/All-New-Amazon-Echo-Dot-Add-Alexa-To-Any-Room/dp/B01DFKC2SO/">Echo Dot</a>.  Since then I've been looking for something useful to do with it.  So far I've been just asking Alexa about the weather, traffic, and (very corny) jokes.</p>
<p>Several of my long ...</p>
                <a class="readmore" href="/introducing-the-biblescholar-alexa-application.html">read more</a>
<p>There are <a href="/introducing-the-biblescholar-alexa-application.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/thoughts-on-agile.html" rel="bookmark"
                           title="Permalink to Thoughts on agile">Thoughts on agile</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-12-21T10:00:00-05:00">
                Published: Wed 21 December 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/turtlemonvh.html">turtlemonvh</a>
        </address>
<p>In <a href="/category/articles.html">Articles</a>.</p>
<p>tags: <a href="/tag/agile.html">agile</a> <a href="/tag/design.html">design</a> </p>
</footer><!-- /.post-info -->                <p>This article on agile was going around <a href="https://www.ionic.com/">my company</a> this morning:
<a href="https://michaelochurch.wordpress.com/2015/06/06/why-agile-and-especially-scrum-are-terrible/">https://michaelochurch.wordpress.com/2015/06/06/why-agile-and-especially-scrum-are-terrible/</a></p>
<p>I was originally typing up a response to the email chain, but decided to just make it into a blog post instead.</p>
<hr />
<p>Agile is great as a communication structure. The ticket ...</p>
                <a class="readmore" href="/thoughts-on-agile.html">read more</a>
<p>There are <a href="/thoughts-on-agile.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/engineering-vs-math-messiness-in-the-system.html" rel="bookmark"
                           title="Permalink to Engineering vs Math: Messiness in the system">Engineering vs Math: Messiness in the system</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-07-18T09:30:00-04:00">
                Published: Mon 18 July 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/turtlemonvh.html">turtlemonvh</a>
        </address>
<p>In <a href="/category/articles.html">Articles</a>.</p>
<p>tags: <a href="/tag/engineering.html">engineering</a> <a href="/tag/optimization.html">optimization</a> <a href="/tag/constraints.html">constraints</a> <a href="/tag/robustness.html">robustness</a> </p>
</footer><!-- /.post-info -->                <p>Yesterday I went to <a href="http://www.lowes.com/">Lowes</a> with my wife to get pieces for a <a href="http://www.rubbermaid.com/en-US/shop-products/closet---shelving">modular shelving unit</a> we were installing in our laundry room.  Instead of going with a pre-packaged shelving arrangement, we had decided to custom cut the shelving for a better fit.  The store had several length options available ...</p>
                <a class="readmore" href="/engineering-vs-math-messiness-in-the-system.html">read more</a>
<p>There are <a href="/engineering-vs-math-messiness-in-the-system.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/helpful-tips-for-testing-in-go.html" rel="bookmark"
                           title="Permalink to Helpful tips for testing in go">Helpful tips for testing in go</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-04-04T11:00:00-04:00">
                Published: Mon 04 April 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/turtlemonvh.html">turtlemonvh</a>
        </address>
<p>In <a href="/category/articles.html">Articles</a>.</p>
<p>tags: <a href="/tag/go.html">go</a> <a href="/tag/testing.html">testing</a> </p>
</footer><!-- /.post-info -->                <p>This post is a summary of some of the best resources I've found for explaining how to test <a href="https://golang.org/">golang</a> applications.</p>
<p>The first section of the article is a list of resources and what I learned from each one. </p>
<p>The second section is a high level summary of suggestions, as ...</p>
                <a class="readmore" href="/helpful-tips-for-testing-in-go.html">read more</a>
<p>There are <a href="/helpful-tips-for-testing-in-go.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/using-pelican-and-github-user-pages-to-setup-a-blog.html" rel="bookmark"
                           title="Permalink to Using pelican and github user pages to setup a blog">Using pelican and github user pages to setup a blog</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-12-27T17:00:00-05:00">
                Published: Sun 27 December 2015
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/turtlemonvh.html">turtlemonvh</a>
        </address>
<p>In <a href="/category/articles.html">Articles</a>.</p>
<p>tags: <a href="/tag/meta.html">meta</a> </p>
</footer><!-- /.post-info -->                <p>This post explains how I set up this blog.</p>
<p>I wrote this partly for myself to make sure I had a well documented way to configure development, and partly for my sister <a href="https://twitter.com/woah_caitlyn">@woah_caitlyn</a> so she could copy any useful parts to make sites for herself and for friends.</p>
<h2>Create repository ...</h2>
                <a class="readmore" href="/using-pelican-and-github-user-pages-to-setup-a-blog.html">read more</a>
<p>There are <a href="/using-pelican-and-github-user-pages-to-setup-a-blog.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="https://www.ionic.com/blog/">Ionic blog</a></li>
                            <li><a href="http://turtle-philosophy.blogspot.com/">My old blog</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://twitter.com/turtlemonvh">twitter</a></li>
                            <li><a href="https://about.me/turtlemonvh">about.me</a></li>
                            <li><a href="https://github.com/turtlemonvh">github</a></li>
                            <li><a href="https://www.linkedin.com/in/vanheetm">linkedin</a></li>
                            <li><a href="https://bitbucket.org/turtlemonvh/">bitbucket</a></li>
                            <li><a href="http://stackoverflow.com/users/790075/turtlemonvh">stackoverflow</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'turtlemonvh-github-io';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>